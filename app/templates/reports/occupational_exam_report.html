<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="date=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">
    <meta name="pdf-engine" content="WeasyPrint">
    <title>Reporte de Ex치menes Ocupacionales</title>
    <link rel="stylesheet" href="css/occupational_exam_report.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                {% if logo_base64 %}
                <img class="logo" src="data:image/png;base64,{{ logo_base64 }}" alt="Logo">
                {% else %}
                <div class="logo">Logo no disponible</div>
                {% endif %}
            </div>
            <div class="header-info">
                <h1>Reporte de Ex치menes Ocupacionales</h1>
                <p>Fecha de generaci칩n: {{ generated_at }}</p>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Resumen Ejecutivo</h2>
            <div class="stats-container">
                <div class="stat-box">
                    <h3>Total Trabajadores</h3>
                    <p>{{ statistics.total_workers }}</p>
                    <span class="stat-label">Activos en el sistema</span>
                </div>
                <div class="stat-box warning-box">
                    <h3>Ex치menes Pendientes</h3>
                    <p>{{ total_pending }}</p>
                    <span class="stat-label">Pr칩ximos 15 d칤as</span>
                </div>
                <div class="stat-box danger-box">
                    <h3>Ex치menes Vencidos</h3>
                    <p>{{ total_overdue }}</p>
                    <span class="stat-label">Requieren atenci칩n inmediata</span>
                </div>
                <div class="stat-box">
                    <h3>Total Ex치menes</h3>
                    <p>{{ statistics.total_exams }}</p>
                    <span class="stat-label">Registrados en el sistema</span>
                </div>
            </div>
            
            <!-- Indicadores de cumplimiento -->
            <div class="compliance-indicators">
                <h3>Indicadores de Cumplimiento</h3>
                <div class="indicator-row">
                    <span class="indicator-label">Cumplimiento General:</span>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ ((statistics.total_workers - total_overdue) / statistics.total_workers * 100) if statistics.total_workers > 0 else 0 }}%"></div>
                    </div>
                    <span class="percentage">{{ "%.1f"|format(((statistics.total_workers - total_overdue) / statistics.total_workers * 100) if statistics.total_workers > 0 else 0) }}%</span>
                </div>
                <div class="indicator-row">
                    <span class="indicator-label">Trabajadores al d칤a:</span>
                    <span class="indicator-value">{{ statistics.total_workers - total_overdue - total_pending }}</span>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Ex치menes Pendientes (Pr칩ximos 15 d칤as)</h2>
            {% if pending_exams %}
            <table>
                <thead>
                    <tr>
                        <th>Trabajador</th>
                        <th>Documento</th>
                        <th>Cargo</th>
                        <th>Fecha del Examen</th>
                        <th>Pr칩ximo Examen</th>
                        <th>D칤as Restantes</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exam in pending_exams %}
                    <tr>
                        <td>{{ exam.worker_name }}</td>
                        <td>{{ exam.worker_document }}</td>
                        <td>{{ exam.cargo }}</td>
                        <td>{{ exam.last_exam_date }}</td>
                        <td>{{ exam.next_exam_date }}</td>
                        <td>{{ exam.days_until_exam }}</td>
                        <td>{{ exam.exam_type }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No hay ex치menes pendientes en los pr칩ximos 15 d칤as.</p>
            {% endif %}
        </div>

        <div class="section">
            <h2 class="section-title">Ex치menes Vencidos</h2>
            {% if overdue_exams %}
            <table>
                <thead>
                    <tr>
                        <th>Trabajador</th>
                        <th>Documento</th>
                        <th>Cargo</th>
                        <th>Fecha del Examen</th>
                        <th>Fecha Vencimiento</th>
                        <th>D칤as Vencido</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exam in overdue_exams %}
                    <tr>
                        <td>{{ exam.worker_name }}</td>
                        <td>{{ exam.worker_document }}</td>
                        <td>{{ exam.cargo }}</td>
                        <td>{{ exam.last_exam_date }}</td>
                        <td>{{ exam.next_exam_date }}</td>
                        <td class="danger">{{ exam.days_overdue }}</td>
                        <td>{{ exam.exam_type }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>No hay ex치menes vencidos.</p>
            {% endif %}
        </div>

        <!-- Secci칩n de Recomendaciones -->
        <div class="section">
            <h2 class="section-title">Recomendaciones</h2>
            <div class="recommendations">
                {% if total_overdue > 0 %}
                <div class="recommendation urgent">
                    <h4>游뚿 Acci칩n Inmediata Requerida</h4>
                    <p>Se han identificado <strong>{{ total_overdue }}</strong> trabajadores con ex치menes ocupacionales vencidos. Es necesario programar estos ex치menes de manera prioritaria para cumplir con la normatividad vigente.</p>
                </div>
                {% endif %}
                
                {% if total_pending > 0 %}
                <div class="recommendation warning">
                    <h4>丘멆잺 Programaci칩n Pr칩xima</h4>
                    <p>Hay <strong>{{ total_pending }}</strong> trabajadores que requieren ex치menes ocupacionales en los pr칩ximos 15 d칤as. Se recomienda coordinar con el proveedor de salud ocupacional para programar estas citas.</p>
                </div>
                {% endif %}
                
                <div class="recommendation info">
                    <h4>游늶 Seguimiento Continuo</h4>
                    <p>Mantener un seguimiento mensual de los vencimientos de ex치menes ocupacionales para garantizar el cumplimiento normativo y la salud de los trabajadores.</p>
                </div>
                
                <div class="recommendation info">
                    <h4>游늵 Indicadores de Gesti칩n</h4>
                    <p>Se recomienda mantener un indicador de cumplimiento superior al 95% en ex치menes ocupacionales al d칤a para demostrar una gesti칩n efectiva del programa de salud ocupacional.</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Este reporte fue generado autom치ticamente por el Sistema de Gesti칩n de SST el {{ generated_at }}.</p>
            <p><strong>Nota:</strong> Este documento es confidencial y debe ser manejado seg칰n las pol칤ticas de protecci칩n de datos personales de la organizaci칩n.</p>
        </div>
    </div>
</body>
</html>