# =============================================================================
# CONFIGURACIÓN DE AUTENTICACIÓN POSTGRESQL (pg_hba.conf)
# =============================================================================
# Configuración segura para contenedor Docker
# =============================================================================

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" is for Unix domain socket connections only
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# RECHAZAR USUARIOS COMUNES DE ATAQUES EXPLÍCITAMENTE
host    all             postgres        0.0.0.0/0               reject
host    all             postgres        ::/0                    reject
host    all             admin           0.0.0.0/0               reject
host    all             admin           ::/0                    reject
host    all             root            0.0.0.0/0               reject
host    all             root            ::/0                    reject
host    all             user            0.0.0.0/0               reject
host    all             user            ::/0                    reject
host    all             test            0.0.0.0/0               reject
host    all             test            ::/0                    reject

# IPv4 local connections (dentro del contenedor)
host    all             postgres        127.0.0.1/32            reject
host    all             postgres        ::1/128                 reject

# Conexiones desde la red Docker (solo para la aplicación)
host    bd_sst          sstuser         172.20.0.0/16           scram-sha-256

# Conexiones desde localhost del host (para administración)
host    bd_sst          sstuser         172.17.0.0/16           scram-sha-256

# RECHAZAR CONEXIONES A BASES DE DATOS COMUNES DE ATAQUES
host    postgres        all             0.0.0.0/0               reject
host    template0       all             0.0.0.0/0               reject
host    template1       all             0.0.0.0/0               reject

# Rechazar todas las demás conexiones
host    all             all             0.0.0.0/0               reject
host    all             all             ::/0                    reject

# =============================================================================
# NOTAS DE SEGURIDAD:
# - Solo se permite conexión al usuario sstuser en la base bd_sst
# - Se usa autenticación scram-sha-256 (más segura)
# - Se rechazan explícitamente usuarios comunes de ataques (postgres, admin, root, etc.)
# - Se rechazan conexiones a bases de datos del sistema
# - Solo se permiten conexiones desde redes Docker internas
# - Todas las demás conexiones son rechazadas por defecto
# =============================================================================