# =============================================================================
# FILTRO FAIL2BAN PARA ESCANEO POSTGRESQL
# =============================================================================

[Definition]
# Detectar escaneos de puertos y ataques de reconocimiento
# Formato estándar de logs de PostgreSQL
failregex = ^.*UTC \[\d+\] FATAL:\s+database ".*" does not exist.*$
            ^.*UTC \[\d+\] FATAL:\s+role ".*" does not exist.*$
            ^.*UTC \[\d+\] DETAIL:\s+Role ".*" does not exist.*$
            ^.*UTC \[\d+\] FATAL:\s+unsupported frontend protocol.*$
            ^.*UTC \[\d+\] FATAL:\s+password authentication failed for user "postgres".*$
            ^.*UTC \[\d+\] FATAL:\s+password authentication failed for user "admin".*$
            ^.*UTC \[\d+\] FATAL:\s+password authentication failed for user "root".*$

# Detectar conexiones con información de cliente (formato extendido)
            ^.*\[.*\]: \[.*\] user=.*,db=.*,app=.*,client=<HOST>.*FATAL:.*database ".*" does not exist.*$
            ^.*\[.*\]: \[.*\] user=.*,db=.*,app=.*,client=<HOST>.*FATAL:.*role ".*" does not exist.*$
            ^.*\[.*\]: \[.*\] user=.*,db=.*,app=.*,client=<HOST>.*FATAL:.*unsupported frontend protocol.*$

# Ignorar conexiones internas
ignoreregex = client=127\.0\.0\.1
              client=172\.20\..*
              client=172\.17\..*
              client=::1